# Caddy reverse proxy with forward_auth to RADIUS backend
{
    # Global options
    auto_https off
    admin off
}

:80 {
    # Health check endpoint
    handle /health {
        respond "OK" 200
    }

    # Login routes (no auth required)
    handle /login {
        reverse_proxy py-radius-auth:5000 {
            header_up X-Original-URL {scheme}://{host}{uri}
        }
    }

    handle /do-login {
        reverse_proxy py-radius-auth:5000 {
            header_up X-Original-URL {scheme}://{host}{uri}
        }
    }

    handle /logout {
        reverse_proxy py-radius-auth:5000 {
            header_up X-Original-URL {scheme}://{host}{uri}
        }
    }

    # Protected routes - require authentication
    handle {
        forward_auth py-radius-auth:5000 {
}
