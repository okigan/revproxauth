# Caddy reverse proxy with forward_auth to RADIUS backend
{
    # Global options
    auto_https off
    admin off
}

:80 {
    # Health check endpoint
    handle /health {
        respond "OK" 200
    }

    # Login routes (no auth required)
    handle /login {
        reverse_proxy go-radius-auth:5000 {
            header_up X-Original-URL {scheme}://{host}{uri}
        }
    }

    handle /do-login {
        reverse_proxy go-radius-auth:5000 {
            header_up X-Original-URL {scheme}://{host}{uri}
        }
    }

    handle /logout {
        reverse_proxy go-radius-auth:5000 {
            header_up X-Original-URL {scheme}://{host}{uri}
        }
    }

    # Protected routes - require authentication
    handle {
        forward_auth go-radius-auth:5000 {
            uri /auth
            copy_headers X-Auth-User
        }
        reverse_proxy whoami:80
    }
}
