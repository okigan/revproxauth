server {
    listen 80;
    server_name app2.yourdomain.com;

    # Include shared auth configuration
    include /etc/nginx/conf.d/auth-common.conf;

    # Protected routes
    location / {
        auth_request /auth;
        auth_request_set $auth_user $upstream_http_x_auth_user;
        proxy_set_header X-Auth-User $auth_user;
        error_page 401 = @error401;
        
        # Different backend
        proxy_pass http://another-app:3000;
        proxy_set_header Host $host;
        
        # WebSocket support
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
    }
}
