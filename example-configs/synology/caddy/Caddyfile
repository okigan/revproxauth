{
    # If Synology handles HTTPS, remove email and use auto_https off
    # email your-email@example.com  # ⚠️ CHANGE THIS to your real email!
    auto_https off
}

# Shared auth configuration
(protected) {
    forward_auth radius-auth-go:8999 {
        uri /auth
        copy_headers X-Auth-User
    }
}

# Login/logout routes (no auth)
(auth-routes) {
    handle /login* {
        reverse_proxy radius-auth-go:8999
    }
    handle /logout {
        reverse_proxy radius-auth-go:8999
    }
}

# Protected sites
gpt-caddy.okulist.com:80 {  # Explicitly listen on port 80 only
    route {
        # Login/logout routes (no auth) - handle FIRST
        handle /login* {
            reverse_proxy radius-auth-go:8999
        }
        handle /logout {
            reverse_proxy radius-auth-go:8999
        }
        
        # Everything else requires auth
        handle {
            forward_auth radius-auth-go:8999 {
                uri /auth
                copy_headers X-Auth-User
            }
            reverse_proxy http://nvbox:8080
        }
    }
}